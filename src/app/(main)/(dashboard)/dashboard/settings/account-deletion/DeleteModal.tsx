"use client";

import { deleteAccount } from "@/actions";
import { FormButton, FormMessage } from "@/components";
import UserAuth from "@/components/server/UserAuth";
import AppToast from "@/components/Toast";
import AppInput from "@/components/ui/AppInput";
import { useUserStore } from "@/state";
import { AppLayoutProps } from "@/utils/types/basicTypes";
import { AlertDialog } from "@radix-ui/themes";
import { useEffect } from "react";
import { useFormState } from "react-dom";
import { toast } from "react-toastify";

export default function DeleteAccountModal({ children }: AppLayoutProps) {
  const { setUser, setArtisan } = useUserStore();
  const [res, action] = useFormState(deleteAccount, {});
  useEffect(() => {
    if (res.success) {
      toast(<AppToast.success message={"Account deleted successfully"} />);
      setUser(null);
      setArtisan(null);
      window.location.href = "/";
    }
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [res]);

  return (
    <>
      <AlertDialog.Root>
        <AlertDialog.Trigger>{children}</AlertDialog.Trigger>
        <AlertDialog.Content
          style={{
            maxWidth: 500,
          }}
        >
          <div className="flex flex-col items-center gap-4 md:p-4">
            {Illustration}
            <h3 className="text-title font-bold text-black-500">
              Confirm Account Deletion
            </h3>
            <p className="text-center font-semibold text-black-300">
              Are you sure you want to delete your account? This will
              permanently erase all of your data and cannot be undone.
            </p>
            <form action={action} className="flex w-full flex-col gap-4">
              <FormMessage res={res} />
              <UserAuth />
              <AppInput
                name="confirm"
                value=""
                title="Type 'I want to delete my account' to confirm"
                placeholder="type here"
                inputProps={{
                  autoComplete: "off",
                }}
                error={res.fieldErrors && res.fieldErrors.confirm}
              />
              <AppInput
                value=""
                name="password"
                title="Password"
                placeholder="Password"
                type="password"
                inputProps={{
                  autoComplete: "off",
                }}
                error={res.fieldErrors && res.fieldErrors.password}
              />
              <div className="grid grid-cols-2 gap-4">
                <FormButton className="btn-primary !border-danger !bg-danger">
                  Permanently Delete
                </FormButton>
                <AlertDialog.Cancel>
                  <button
                    role="button"
                    className="btn-light !border-50 !bg-black-50"
                  >
                    Cancel
                  </button>
                </AlertDialog.Cancel>
              </div>
            </form>
          </div>
        </AlertDialog.Content>
      </AlertDialog.Root>
    </>
  );
}

const Illustration = (
  <svg
    width="80"
    height="80"
    viewBox="0 0 80 80"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <rect width="80" height="80" rx="40" fill="#BE2828" />
    <g clip-path="url(#clip0_4320_9730)">
      <path
        d="M50.2936 51.1081L52.5136 53.3303M52.5136 53.3303L54.7381 55.5525M52.5136 53.3303L54.7381 51.1081M52.5136 53.3303L50.2936 55.5525M61.4047 53.3303C61.4047 55.6878 60.4682 57.9487 58.8012 59.6157C57.1342 61.2827 54.8733 62.2192 52.5158 62.2192C50.1584 62.2192 47.8974 61.2827 46.2304 59.6157C44.5635 57.9487 43.627 55.6878 43.627 53.3303C43.627 50.9728 44.5635 48.7119 46.2304 47.0449C47.8974 45.3779 50.1584 44.4414 52.5158 44.4414C54.8733 44.4414 57.1342 45.3779 58.8012 47.0449C60.4682 48.7119 61.4047 50.9728 61.4047 53.3303Z"
        stroke="white"
        strokeWidth="2.5"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
      <path
        d="M29.0779 52.1918C28.9244 52.3507 28.804 52.5385 28.7238 52.7444C28.6435 52.9502 28.605 53.17 28.6105 53.3908C28.6159 53.6117 28.6652 53.8293 28.7555 54.0309C28.8458 54.2326 28.9753 54.4142 29.1365 54.5654C29.2976 54.7165 29.4872 54.8341 29.6942 54.9113C29.9013 54.9885 30.1216 55.0238 30.3423 55.015C30.5631 55.0063 30.7799 54.9538 30.9802 54.8606C31.1805 54.7673 31.3602 54.6351 31.509 54.4718L29.0779 52.1918ZM37.1356 51.6562C37.3533 51.6332 37.5644 51.5674 37.7567 51.4628C37.949 51.3582 38.1188 51.2168 38.2564 51.0465C38.3941 50.8763 38.4968 50.6806 38.5588 50.4706C38.6209 50.2607 38.6409 50.0406 38.6179 49.8229C38.5948 49.6052 38.5291 49.3941 38.4245 49.2018C38.3199 49.0095 38.1784 48.8397 38.0082 48.7021C37.8379 48.5644 37.6422 48.4617 37.4323 48.3997C37.2223 48.3377 37.0022 48.3176 36.7845 48.3407L37.1356 51.6562ZM32.5223 23.8873C32.7412 23.8864 32.9577 23.8425 33.1596 23.7579C33.3615 23.6733 33.5447 23.5498 33.6989 23.3945C33.853 23.2391 33.975 23.0548 34.058 22.8523C34.1409 22.6498 34.1832 22.4329 34.1823 22.214C34.1814 21.9951 34.1374 21.7786 34.0529 21.5767C33.9683 21.3748 33.8448 21.1916 33.6894 21.0374C33.534 20.8833 33.3498 20.7613 33.1473 20.6783C32.9447 20.5954 32.7278 20.5531 32.509 20.554L32.5223 23.8873ZM43.6334 20.554C43.4145 20.5531 43.1976 20.5954 42.9951 20.6783C42.7926 20.7613 42.6083 20.8833 42.4529 21.0374C42.2976 21.1916 42.1741 21.3748 42.0895 21.5767C42.0049 21.7786 41.961 21.9951 41.9601 22.214C41.9592 22.4329 42.0014 22.6498 42.0844 22.8523C42.1673 23.0548 42.2894 23.2391 42.4435 23.3945C42.5977 23.5498 42.7809 23.6733 42.9828 23.7579C43.1847 23.8425 43.4012 23.8864 43.6201 23.8873L43.6334 20.554ZM55.2934 39.9984C55.2934 40.4405 55.469 40.8644 55.7816 41.1769C56.0941 41.4895 56.5181 41.6651 56.9601 41.6651C57.4021 41.6651 57.826 41.4895 58.1386 41.1769C58.4512 40.8644 58.6267 40.4405 58.6267 39.9984H55.2934ZM36.9601 63.8873C37.4021 63.8873 37.826 63.7117 38.1386 63.3992C38.4511 63.0866 38.6267 62.6627 38.6267 62.2207C38.6267 61.7786 38.4511 61.3547 38.1386 61.0421C37.826 60.7296 37.4021 60.554 36.9601 60.554V63.8873ZM40.849 39.9984C40.849 41.5584 39.6112 42.7762 38.1401 42.7762V46.1095C41.5023 46.1095 44.1823 43.3495 44.1823 39.9984H40.849ZM38.1401 42.7762C36.6712 42.7762 35.4334 41.5584 35.4334 39.9984H32.1001C32.1001 43.3495 34.7801 46.1095 38.1401 46.1095V42.7762ZM35.4356 39.9984C35.4356 38.4384 36.6734 37.2207 38.1423 37.2207V33.8873C34.7823 33.8873 32.1023 36.6473 32.1023 39.9984H35.4356ZM38.1423 37.2207C39.6134 37.2207 40.8512 38.4384 40.8512 39.9984H44.1845C44.1845 36.6473 41.5045 33.8873 38.1423 33.8873V37.2207ZM31.5112 54.4718C32.9881 52.8885 34.983 51.8892 37.1356 51.6562L36.7867 48.3407C33.839 48.6582 31.1015 50.025 29.0779 52.1918L31.5112 54.4718ZM20.849 47.4829V36.9584H17.5156V47.4829H20.849ZM34.7379 60.554C31.0267 60.554 28.4023 60.5518 26.4134 60.2984C24.4645 60.0495 23.3823 59.5873 22.6067 58.854L20.3134 61.2718C21.8179 62.6962 23.7067 63.3118 25.9934 63.6051C28.2401 63.8895 31.1156 63.8873 34.7379 63.8873V60.554ZM17.5156 47.4829C17.5156 50.9073 17.5112 53.6518 17.8179 55.8029C18.129 58.0118 18.7979 59.8362 20.3134 61.2718L22.6067 58.8518C21.8445 58.1295 21.3734 57.1407 21.1179 55.334C20.8512 53.4718 20.849 51.0073 20.849 47.4829H17.5156ZM58.6267 36.9584C58.6267 33.534 58.6312 30.7895 58.3245 28.6384C58.0134 26.4295 57.3445 24.6051 55.829 23.1695L53.5356 25.5873C54.2979 26.3095 54.769 27.3007 55.0245 29.1073C55.2912 30.9695 55.2934 33.434 55.2934 36.9584H58.6267ZM20.849 36.9584C20.849 33.434 20.8534 30.9695 21.1156 29.1073C21.3734 27.3029 21.8445 26.3118 22.6045 25.5895L20.3156 23.1673C18.7979 24.6051 18.1312 26.4295 17.8179 28.6384C17.5112 30.7895 17.5156 33.534 17.5156 36.9584H20.849ZM32.509 20.5584C29.589 20.5673 27.2023 20.6207 25.2734 20.9429C23.3045 21.2695 21.6556 21.8984 20.3134 23.1695L22.6067 25.5873C23.3001 24.9295 24.2401 24.494 25.8201 24.2295C27.4423 23.9607 29.5667 23.8984 32.5223 23.8873L32.509 20.5584ZM43.6201 23.8918C46.5756 23.9007 48.7001 23.9607 50.3223 24.2295C51.9023 24.494 52.8423 24.9295 53.5356 25.5873L55.829 23.1695C54.4867 21.9007 52.8379 21.2695 50.869 20.9429C48.9401 20.6207 46.5534 20.5651 43.6334 20.554L43.6201 23.8918ZM55.2934 36.9584V39.9984H58.6267V36.9584H55.2934ZM36.9601 60.554H34.7379V63.8873H36.9601V60.554ZM41.3979 21.7762L41.5823 22.5762L44.8312 21.8251L44.6467 21.0273L41.3979 21.7762ZM39.1779 24.9984H36.9645V28.3318H39.1779V24.9984ZM34.5601 22.5762L34.7445 21.7762L31.4956 21.0273L31.3112 21.8273L34.5601 22.5762ZM36.9645 24.9984C36.0067 24.9984 35.3979 24.9984 34.9467 24.9562C34.7754 24.943 34.6057 24.9132 34.4401 24.8673L34.4223 24.8607L32.6934 27.7095C33.3267 28.094 34.0134 28.2207 34.6556 28.2784C35.2867 28.334 36.0667 28.3318 36.9645 28.3318V24.9984ZM31.3112 21.8273C31.1312 22.6073 30.9623 23.3229 30.889 23.9207C30.8156 24.5407 30.8112 25.2562 31.1356 25.9718L34.1712 24.594C34.2112 24.6829 34.1579 24.674 34.2001 24.3207C34.2445 23.9429 34.3623 23.4295 34.5601 22.5762L31.3112 21.8273ZM34.4223 24.8607C34.3153 24.797 34.2283 24.7046 34.1712 24.594L31.1356 25.9718C31.469 26.7051 32.0223 27.3007 32.6934 27.7095L34.4223 24.8607ZM41.5823 22.5762C41.7823 23.4295 41.8956 23.9429 41.9423 24.3207C41.9867 24.6762 41.9312 24.6807 41.9712 24.594L45.0067 25.9718C45.3312 25.2562 45.3267 24.5407 45.2512 23.9207C45.1801 23.3229 45.0112 22.6095 44.829 21.8273L41.5823 22.5762ZM39.1779 28.3318C40.0756 28.3318 40.8556 28.3318 41.489 28.2784C42.129 28.2207 42.8179 28.094 43.4512 27.7095L41.7201 24.8607H41.7156L41.7023 24.8673L41.6267 24.8918C41.5445 24.914 41.4112 24.9384 41.1956 24.9584C40.7445 24.9962 40.1356 24.9984 39.1779 24.9984V28.3318ZM41.9712 24.594C41.914 24.7046 41.827 24.797 41.7201 24.8607L43.4512 27.7095C44.1245 27.3007 44.6756 26.7029 45.0067 25.9718L41.9712 24.594ZM38.0712 19.4429C39.2045 19.4429 39.4934 19.454 39.7156 19.5051L40.4645 16.2562C39.7823 16.1007 39.029 16.1095 38.0712 16.1095V19.4429ZM44.6467 21.0273C44.4556 20.2051 44.3023 19.4718 43.9623 18.8473L41.0334 20.4384C41.1023 20.5673 41.1623 20.7562 41.3979 21.7784L44.6467 21.0273ZM39.7156 19.5051C40.3445 19.6495 40.8045 20.0162 41.0334 20.4384L43.9623 18.8473C43.5943 18.1937 43.0925 17.6252 42.4898 17.1787C41.8871 16.7322 41.197 16.4179 40.4645 16.2562L39.7156 19.5051ZM38.0712 16.1095C37.1134 16.1095 36.3601 16.0984 35.6779 16.2562L36.4267 19.5051C36.649 19.454 36.9379 19.4429 38.0712 19.4429V16.1095ZM34.7445 21.7762C34.9801 20.7562 35.0401 20.5673 35.109 20.4384L32.1823 18.8473C31.8445 19.4695 31.689 20.2029 31.4979 21.0251L34.7445 21.7762ZM35.6779 16.2562C34.9454 16.4179 34.2553 16.7322 33.6526 17.1787C33.0499 17.6252 32.5481 18.1937 32.1801 18.8473L35.109 20.4384C35.2517 20.1998 35.4426 19.9936 35.6695 19.8329C35.8964 19.6722 36.1543 19.5605 36.4267 19.5051L35.6779 16.2562Z"
        fill="white"
      />
      <path
        d="M30.293 53.3305C32.3307 51.1594 35.233 50.0238 38.1396 49.9972M42.5152 39.9972C42.5152 42.4527 40.5574 44.4416 38.1396 44.4416C35.7241 44.4416 33.7663 42.4527 33.7663 39.9972C33.7663 37.5416 35.7241 35.5527 38.1396 35.5527C40.5596 35.5527 42.5152 37.5416 42.5152 39.9972Z"
        stroke="white"
        strokeWidth="2.5"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
      <path
        d="M32.515 22.2249C26.6394 22.2471 23.495 22.4515 21.4594 24.3804C19.1816 26.5382 19.1816 30.0115 19.1816 36.9582V47.4849C19.1816 54.4315 19.1816 57.9071 21.4594 60.0627C23.7372 62.2227 27.4039 62.2227 34.7372 62.2227H39.1816M43.6261 22.2227C49.5016 22.2449 52.6461 22.4515 54.6816 24.3782C56.9594 26.5382 56.9594 30.0115 56.9594 36.9582V38.8893"
        stroke="white"
        strokeWidth="2.5"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
      <path
        d="M33.1214 21.4021C33.3348 20.4798 33.4414 20.0176 33.6459 19.6421C33.9001 19.1952 34.2459 18.8072 34.6607 18.5034C35.0755 18.1997 35.5498 17.9872 36.0526 17.8798C36.5037 17.7754 37.0281 17.7754 38.0726 17.7754C39.117 17.7754 39.6414 17.7754 40.0926 17.8798C40.5953 17.9872 41.0697 18.1997 41.4844 18.5034C41.8992 18.8072 42.2451 19.1952 42.4992 19.6421C42.7037 20.0198 42.8103 20.4798 43.0237 21.4021L43.2081 22.2021C43.5859 23.8354 43.7748 24.6532 43.4903 25.2821C43.2965 25.6995 42.9813 26.0487 42.5859 26.2843C41.9614 26.6643 41.0326 26.6643 39.1792 26.6643H36.9659C35.1126 26.6643 34.1837 26.6643 33.5592 26.2865C33.1635 26.0504 32.8483 25.7003 32.6548 25.2821C32.3703 24.6532 32.5592 23.8376 32.937 22.2021L33.1214 21.4021Z"
        stroke="white"
        strokeWidth="2.5"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
    </g>
    <defs>
      <clipPath id="clip0_4320_9730">
        <rect
          width="53.3333"
          height="53.3333"
          fill="white"
          transform="translate(13.334 13.334)"
        />
      </clipPath>
    </defs>
  </svg>
);
